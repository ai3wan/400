# –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìù –°–ø–∏—Å–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π

### migration_001_add_inn_gorod.sql
**–î–∞—Ç–∞:** 2025-10-21  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –ò–ù–ù –∏ –ì–æ—Ä–æ–¥ –≤ —Ç–∞–±–ª–∏—Ü—É kompanii

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `inn` (VARCHAR(12)) - –ò–ù–ù –∫–æ–º–ø–∞–Ω–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `gorod` (VARCHAR(100)) - –≥–æ—Ä–æ–¥ –º–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –ò–ù–ù (10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä)
- –°–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
- –ó–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π

---

## üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ë–ï–ó –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö!

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh tnb_user_1@198.177.123.150

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –º–∏–≥—Ä–∞—Ü–∏–π
cd /home/tnb_user_1/public_html/400/backend/database

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
psql -U tnb_user_1_vsm400_user -h localhost -d tnb_user_1_vsm400 -f migration_001_add_inn_gorod.sql

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
psql -U tnb_user_1_vsm400_user -h localhost -d tnb_user_1_vsm400 -c "\d kompanii"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞:

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
SELECT id, nazvanie, inn, gorod, rol FROM kompanii ORDER BY id;
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ò–ù–ù –∏ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–∞–Ω–∏–π.

---

## üìã –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

1. **–í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π:**
   ```bash
   pg_dump -U tnb_user_1_vsm400_user -h localhost tnb_user_1_vsm400 > backup_before_migration.sql
   ```

2. **–ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É:**
   ```bash
   psql ... -f migration_001_add_inn_gorod.sql
   # psql ... -f migration_002_next_migration.sql
   # –∏ —Ç.–¥.
   ```

3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏**

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API** (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö):
   ```bash
   sudo systemctl restart dashboard-api
   ```

---

## üîÑ –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞
psql -U tnb_user_1_vsm400_user -h localhost -d tnb_user_1_vsm400 -f backup_before_migration.sql
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é —É–¥–∞–ª–∏—Ç–µ –∫–æ–ª–æ–Ω–∫–∏:

```sql
-- –û—Ç–∫–∞—Ç migration_001
ALTER TABLE kompanii DROP COLUMN IF EXISTS inn;
ALTER TABLE kompanii DROP COLUMN IF EXISTS gorod;
DROP INDEX IF EXISTS idx_kompanii_inn;
DROP INDEX IF EXISTS idx_kompanii_gorod;
```

---

## üìä –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

–®–∞–±–ª–æ–Ω:

```sql
-- –ú–∏–≥—Ä–∞—Ü–∏—è: –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
-- –î–∞—Ç–∞: YYYY-MM-DD

-- 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π
ALTER TABLE table_name ADD COLUMN IF NOT EXISTS new_field TYPE;

-- 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
CREATE INDEX IF NOT EXISTS idx_name ON table(field);

-- 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
UPDATE table_name SET new_field = 'value' WHERE condition;
```

---

## ‚úÖ Best Practices

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏–∑–º–µ–Ω—è–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏** - —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ
2. **–í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø** –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –∫–æ–ø–∏–∏ –ë–î** –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ IF NOT EXISTS** –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
5. **–ù—É–º–µ—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏** –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (001, 002, 003...)

